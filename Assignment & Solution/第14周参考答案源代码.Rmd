---
title: "ç¬¬14å‘¨ä½œä¸š"
author: "2018201744 éƒ­æˆåŸ"
date: "12/17/2020"
output:
  rmdformats::readthedown:
    self_contained: true
    thumbnails: true
    lightbox: true
    toc_depth: 5
    gallery: false
    highlight: tango
    df_print: kable
    
---

<style>
#main .nav-pills > li.active > a,
#main .nav-pills > li.active > a:hover,
#main .nav-pills > li.active > a:focus {
background-color: #4a47a3;
}
#main .nav-pills > li > a:hover {
color: #FFFFFF !important;
background-color: #4a47a3;
}
#main .nav-pills > li.active > a,
#main .nav-pills > li.active > a:hover,
#main .nav-pills > li.active > a:focus {
color: #FFFFFF !important;
background-color: #4a47a3;
}

#main .nav-pills > li > a:hover {
background-color: #4a47a3;
}

h1, h2, h3, h4, h5, h6, legend {
color: #4a47a3;
}

#nav-top span.glyphicon {
color: #4a47a3;
}

#table-of-contents header {
color: #4a47a3;
}

#table-of-contents h2 {
background-color: #4a47a3;
}

#main a {
background-image: linear-gradient(180deg,#d64a70,#d64a70);
color: #c7254e;
}

a:hover {
color: #3d1308;
}

a:visited {
color: #3d1308;
}
#postamble .date {
font-size: 100%;
margin-bottom: 0px;
color: #dcd6f7;
}
#sidebar h2{
z-index:200;
background-color:#4a47a3;
text-align:center;
padding:0.809em;
display:block;
color:#fcfcfc;
font-size: 100%;
margin-top: 0px;
margin-bottom:0.809em;
}
</style>





```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### æ–°æ•™æ6.4 100åç‰™ç–¾æ‚£è€…ï¼Œå…ˆåç»è¿‡ä¸¤ä½ä¸åŒçš„ç‰™åŒ»çš„è¯Šæ²»ï¼Œä¸¤ä½ç‰™åŒ»åœ¨æ˜¯å¦éœ€è¦è¿›è¡ŒæŸé¡¹å¤„ç†æ—¶ç»™å‡ºçš„è¯Šæ²»æ–¹æ¡ˆä¸å®Œå…¨ä¸€è‡´ï¼ç°å°†ä¸¤ä½ç‰™åŒ»çš„ä¸åŒæ„è§æ•°æ®åˆ—è¡¨å¦‚ä¸‹ï¼Œè¯•åˆ†æä¸¤ä½åŒ»ç”Ÿçš„æ²»ç–—æ–¹æ¡ˆæ˜¯å¦å®Œå…¨ä¸€è‡´ï¼





<table>
<thead>
<tr class="header">
<th colspan="2"></th>
<th colspan="3"><center>ç‰™åŒ»ä¹™</center></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td  colspan="2"></td>
<td>éœ€è¦å¤„ç†</td>
<td>ä¸éœ€è¦å¤„ç†</td>
<td>åˆè®¡</td>
</tr>
<tr class="even">
<td rowspan="3">ç‰™åŒ»ç”²</td>
<td>éœ€è¦å¤„ç†</td>
<td>40</td>
<td>5</td>
<td>45</td>
</tr>
<tr class="odd">
<td>ä¸éœ€è¦å¤„ç†</td>
<td>25</td>
<td>30</td>
<td>55</td>
</tr>
<tr class="even">
<td>åˆè®¡</td>
<td>65</td>
<td>35</td>
<td>100</td>
</tr>
</tbody>
</table>

å¯¹åŒä¸€ç»„ç ”ç©¶å¯¹è±¡è¿›è¡Œä¸¤æ¬¡ç‹¬ç«‹è¯„åˆ¤ï¼Œè€ƒå¯Ÿå…¶ä¸€è‡´æ€§æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨Kappaä¸€è‡´æ€§æ£€éªŒï¼Œ$$H_0:ä¸¤ä½åŒ»ç”Ÿçš„æ²»ç–—æ–¹æ¡ˆä¸ä¸€è‡´ \quad v.s.\ \ H_1:ä¸¤ä½åŒ»ç”Ÿçš„æ²»ç–—æ–¹æ¡ˆä¸€è‡´$$
Kappaä¸€è‡´æ€§æ£€éªŒä¸‹ï¼Œå®šä¹‰$$P_0=\sum\limits_{i=1}^rp_{ii}$$$$P_e=\sum\limits_{i=1}^rp_i.p._i$$$P_e$è¡¨ç¤ºçš„æ˜¯ä¸€è‡´æ€§æœŸæœ›é¢‘ç‡ï¼Œé‚£ä¹ˆ$P_0-P_e$è¡¨ç¤ºçš„æ˜¯å®é™…ä¸ç‹¬ç«‹åˆ¤æ–­ç»“æœæ¦‚ç‡ä¹‹å·®ï¼Œé‚£ä¹ˆå¯ä»¥æ„å»ºKappaç»Ÿè®¡é‡$$K=\dfrac{P_0-P_e}{1-P_e}$$ï¼Œå®ƒçš„æ–¹å·®ä¸º$$varK=\frac1{n(1-P_e)^2}[P_e+P_e^2-\sum p_i.p._i(p_i.+p._i)]$$
å› æ­¤å¯ä»¥æ„é€ æ¸è¿›æ­£æ€çš„æ£€éªŒç»Ÿè®¡é‡$Z=\frac K{\sqrt{varK}}$ã€‚æœ¬é¢˜ä¸­ï¼Œè®¡ç®—å¾—$P_0=0.7,\ P_e=0.485$ï¼ŒKappaç»Ÿè®¡é‡ä¸º$K=0.417,\ Z=4.53>1.96$ï¼Œæ£€éªŒç»Ÿè®¡é‡å€¼å¾ˆå¤§ï¼Œè¿œå¤§äºä¸´ç•Œå€¼ï¼Œ$p$å€¼å¾ˆå°ï¼Œå› æ­¤æœ‰å……è¶³çš„ç†ç”±æ‹’ç»$H_0$ï¼Œè®¤ä¸ºä¸¤ä¸ªç‰™åŒ»å­˜åœ¨ä¸€è‡´æ€§ã€‚

```{r,warning=F,message=F}
#å¯¹è§’çº¿æ¦‚ç‡å’Œ
P0=(40+30)/100

#ä¸€è‡´æ€§æœŸæœ›æ¦‚ç‡
Pe=.65*.45+.35*.55

K=(P0-Pe)/(1-Pe)
varK=1/100/(1-Pe)^2*(Pe+Pe^2-.65*.45*(.65+.45)-.35*.55*(.35+.55))
Z=K/sqrt(varK)

#æ£€éªŒpå€¼
2*(1-pnorm(Z))
```

è½½å…¥`irr`åŒ…ï¼Œè¿™ä¸ªåŒ…æä¾›äº†è¿›è¡ŒKappaæ£€éªŒçš„å¤šä¸ªå‡½æ•°ï¼Œè¿™é‡Œè°ƒç”¨`kappa2(ratings, weight = c("unweighted", "equal", "squared"), sort.levels = FALSE)`ï¼Œå®ƒå¯ä»¥å¯¹ä¸¤ä¸ªè¯„åˆ†è€…å¯¹è¯„åˆ†å¯¹ä¸€è‡´æ€§è¿›è¡Œæ£€éªŒï¼Œè¿™é‡Œåœ¨è¾“å…¥æ—¶æŠŠé¢˜ç›®ç»™å®šå¯¹åˆ—è”è¡¨è½¬æ¢ä¸ºäº†è¯„åˆ†å‘é‡ï¼Œå‘é‡ä¸­1å€¼ä»£è¡¨ã€Œéœ€è¦å¤„ç†ã€ï¼Œ0å€¼ä»£è¡¨ã€Œä¸éœ€è¦å¤„ç†ã€ã€‚æœ€ç»ˆå¾—åˆ°äº†ç›¸åŒå¯¹$Z$å€¼å’Œæ£€éªŒç»“æœã€‚
```{R,message=F}
library(irr)
dat=data.frame(ç”²=c(rep(1,45),rep(0,55)),ä¹™=c(rep(1,40),rep(0,5),rep(1,25),rep(0,30)))
kappa2(dat)
```


å¯¹äºå…¶ä¸­çš„`weight = c("unweighted", "equal", "squared")`å‚æ•°ï¼Œå¦‚æœåœ¨æœ‰å¤šä¸ªæ£€æŸ¥é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªæ˜¯ä¸º0çš„æ—¶å€™éœ€è¦åŠ æƒæ£€éªŒï¼Œè€Œæœ¬é¢˜ä¸­åªæœ‰ã€Œéœ€è¦å¤„ç†ã€ä¸ã€Œä¸éœ€è¦å¤„ç†ã€ä¸¤ç§å–å€¼ï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡ŒåŠ æƒï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤å‚æ•°`unweighted`ã€‚

æ­¤å¤–ï¼Œ`irr`ä¸­`kappam.fleiss`æä¾›äº†å¯¹äºå¤šä¸ªè¯„åˆ†è€…å¯¹æ•°æ®è¿›è¡Œä¸€è‡´æ€§æ£€éªŒå¯¹æ–¹æ³•ã€‚Fleiss' kappaç³»æ•°é€‚ç”¨äºåˆ†æé‡å¤æµ‹é‡3æ¬¡åŠä»¥ä¸Šä¸”æµ‹é‡ç»“æœæ˜¯æ— åºåˆ†ç±»å˜é‡çš„é‡æµ‹ä¸€è‡´æ€§æˆ–è§‚å¯Ÿè€…ä¸€è‡´æ€§æ£€éªŒã€‚å– irr åŒ…ä¸­çš„diagnoses æ•°æ®é›†çš„ä¸€éƒ¨åˆ†ï¼Œæˆªå–å‰ä¸‰ä¸ªåŒ»ç”Ÿå¯¹ 30 ä½ç—…äººçš„è¯Šæ–­ç»“æœï¼Œåˆ©ç”¨irråŒ…ä¸­çš„`kappam.fleiss`å‡½æ•°å®ç°Fleiss' kappaç³»æ•°çš„è®¡ç®—ã€‚

å¾—åˆ°çš„kappaç³»æ•°å€¼ä¸º0.534ï¼Œpå€¼æ¥è¿‘0ï¼Œè®¤ä¸ºæ•°æ®é—´å­˜åœ¨ä¸€è‡´æ€§ã€‚

```{r,warning=F,message=F}
data(diagnoses)
kappam.fleiss(diagnoses[,1:3])


```

### æ–°æ•™æ6.8 æœ‰å…³åˆ†ä½å›å½’ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼
#### ï¼ˆ1ï¼‰ç®€è¿°åˆ†ä½å›å½’æ¨¡å‹ï¼

åˆ†ä½æ•°å›å½’æ˜¯ä¼°è®¡ä¸€ç»„å›å½’å˜é‡$X$ä¸è¢«è§£é‡Šå˜é‡$Y$çš„åˆ†ä½æ•°ä¹‹é—´çº¿æ€§å…³ç³»çš„å»ºæ¨¡æ–¹æ³•ï¼Œç”±ç§‘æ©å…‹ï¼ˆKoenkerï¼‰å’Œå·´å¡ç‰¹ï¼ˆBassettï¼‰äº1978å¹´æå‡ºçš„ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯å»ºç«‹å› å˜é‡$Y$å¯¹è‡ªå˜é‡$X$çš„æ¡ä»¶åˆ†ä½æ•°å›å½’æ‹Ÿåˆæ¨¡å‹ï¼š
$$Q_Y(\tau|X)=f(X)$$
å…¶ä¸­ï¼Œ$\tau$æ˜¯å› å˜é‡$Y$åœ¨å…¥æ¡ä»¶ä¸‹çš„åˆ†ä½æ•°ï¼Œ$f(X)$æ‹Ÿåˆ$Y$çš„ç¬¬$\tau$åˆ†ä½æ•°

ä¼ ç»Ÿçš„å›å½’å»ºç«‹åœ¨è¢«è§£é‡Šå˜é‡çš„æ¡ä»¶æœŸæœ›çš„åŸºç¡€ä¸Šï¼Œå½“$\varepsilon$æ»¡è¶³æ­£æ€å’Œé½æ€§ï¼ˆæ–¹å·®ç›¸ç­‰ï¼‰æ¡ä»¶æ—¶ï¼Œå¯ä»¥ç”¨æœ€å°äºŒä¹˜æ³•å»ºç«‹å›å½’ã€é¢„æµ‹æ¨¡å‹ï¼Œå®é™…æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªå‡è®¾å¾€å¾€å¾—ä¸åˆ°æ»¡è¶³ï¼Œæ¯”å¦‚å·¦åæˆ–å³åï¼Œç”¨æœ€å°äºŒä¹˜æ‹Ÿåˆå›å½’æ¨¡å‹ç¨³å®šæ€§å¾ˆå·®ï¼Œåˆ†ä½å›å½’å¯¹åˆ†ä½æ•°è¿›è¡Œå›å½’ï¼Œä¸éœ€è¦åˆ†å¸ƒå’Œé½æ€§æ–¹é¢è¿‡å¼ºçš„å‡è®¾ï¼Œåœ¨éæ­£æ€å’Œéé½æ€§çš„æƒ…å†µä¸‹ä¹Ÿèƒ½è¾ƒå¥½åœ°æŠŠæ¡æ•°æ®çš„ä¸»è¦è§„å¾‹ï¼Œåˆ†ä½å›å½’ä»¥å…¶ç¨³å¥çš„æ€§è´¨å·±ç»å¼€å§‹åœ¨ç»æµå’ŒåŒ»å­¦é¢†åŸŸå¹¿æ³›åº”ç”¨ã€‚

#### ï¼ˆ2ï¼‰ç®€è¿°åˆ†ä½å›å½’æ¨¡å‹å‚æ•°ä¼°è®¡çš„æœ€ä¼˜åŒ–é—®é¢˜ï¼

çº¿æ€§åˆ†ä½å›å½’å¯ä»¥é€šè¿‡æå°åŒ–æ®‹å·®ç»å¯¹å€¼åŠ æƒæ±‚å’Œï¼Œå³åœ¨ç»å¯¹å€¼å‰å¢åŠ åˆ†ä½ç‚¹æƒé‡ç³»æ•°ï¼š$$\hat\beta=\mathop{argmin}\limits_{\beta\in\mathbb{r,warning=F,message=F}^p}\sum_{i=1}^n\rho_\tau(y_i-x_i^T\beta)$$ï¼Œå…¶ä¸­$$\tau(u)=\left\{
\begin{aligned}
&\tau u&,u\geq0\\
&(1-\tau)|u|&, u<0
\end{aligned}
\right.$$
å› æ­¤ç­‰ä»·ä¸º$$\hat\beta(\tau)=\mathop{argmin}\left[\sum_{i\in\{i:y_i\geq x_i^T\beta(\tau)\}}\tau|y_i-x_i^T\beta(\tau)|_++\sum_{i\in\{i:y_i< x_i^T\beta(\tau)\}}(1-\tau)|y_i-x_i^T\beta(\tau)|_-\right]$$
Koenkerå’Œå¥¥åˆ©ï¼ˆOreyï¼‰ï¼ˆ1993ï¼‰è¿ç”¨è¿ç­¹å­¦ä¸­çš„å•çº¯å½¢æ³•æ±‚è§£çº¿æ€§åˆ†ä½å›å½’ï¼Œå…¶æ€æƒ³æ˜¯ï¼šä»»é€‰ä¸€ä¸ªé¡¶ç‚¹ï¼Œæ²¿ç€å¯è¡Œè§£å›´æˆçš„å¤šè¾¹å½¢è¾¹ç•Œæœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°æœ€ä¼˜ç‚¹ã€‚è¯¥ç®—æ³•ä¼°è®¡å‡ºæ¥çš„å‚æ•°å…·æœ‰å¾ˆå¥½çš„ç¨³å®šæ€§ï¼Œä½†æ˜¯åœ¨å¤„ç†å¤§å‹æ•°æ®æ—¶è¿ç®—çš„é€Ÿåº¦ä¼šæ˜¾è‘—é™ä½ã€‚

ç›®å‰æµè¡Œçš„è¿˜æœ‰å†…ç‚¹ç®—æ³•ï¼ˆinterior point methodï¼‰ï¼Œå’Œå¹³æ»‘ç®—æ³•ï¼ˆsmoothing method)ç­‰ã€‚å†…ç‚¹ç®—æ³•å¯¹äºé‚£äº›å…·æœ‰å¤§é‡è§‚å¯Ÿå€¼å’Œå°‘é‡å˜é‡çš„æ•°æ®é›†è¿ç®—æ•ˆç‡å¾ˆé«˜ï¼›å¹³æ»‘ç®—æ³•åœ¨ç†è®ºä¸Šæ¯”è¾ƒç®€å•ï¼Œå®ƒé€‚åˆå¤„ç†å…·æœ‰å¤§é‡è§‚å¯Ÿå€¼ä»¥åŠå¾ˆå¤šå˜é‡çš„æ•°æ®é›†ã€‚ç”±äºåˆ†ä½å›å½’éœ€è¦å€ŸåŠ©å¤§é‡è®¡ç®—ï¼Œæ¨¡å‹çš„å‚æ•°ä¼°è®¡è¦æ¯”ä¼ ç»Ÿçš„çº¿æ€§å›å½’æ¨¡å‹çš„æ±‚è§£å¤æ‚ã€‚


#### ï¼ˆ3ï¼‰åˆ†ä½å›å½’ç›¸æ¯”äºçº¿æ€§å›å½’çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿä¸ºä»€ä¹ˆå…·å¤‡è¿™äº›ä¼˜ç‚¹ï¼Ÿ


ä¸çº¿æ€§æœ€å°äºŒä¹˜å›å½’ç›¸æ¯”è¾ƒï¼Œåˆ†ä½å›å½’çš„ä¼˜ç‚¹ä½“ç°åœ¨ä»¥ä¸‹å‡ æ–¹é¢ï¼š

1. åˆ†ä½å›å½’å¯¹æ¨¡å‹ä¸­çš„éšæœºè¯¯å·®é¡¹ä¸éœ€å¯¹åˆ†å¸ƒåšå…·ä½“çš„å‡å®šï¼Œæœ‰å¹¿æ³›çš„é€‚ç”¨æ€§ï¼›
2. åˆ†ä½å›å½’æ²¡æœ‰ä½¿ç”¨è¿æ¥å‡½æ•°æè¿°å› å˜é‡ä¸è‡ªå˜é‡çš„ç›¸äº’å…³ç³»ï¼Œå› æ­¤åˆ†ä½å›å½’ä½“ç°äº†æ•°æ®é©±åŠ¨çš„å»ºæ¨¡æ€æƒ³ï¼›
3. ä¸­ä½æ•°å›å½’çš„ä¼°è®¡æ–¹æ³•ä¸æœ€å°äºŒä¹˜æ³•ç›¸æ¯”ï¼Œä¼°è®¡ç»“æœå¯¹ç¦»ç¾¤å€¼åˆ™è¡¨ç°çš„æ›´åŠ ç¨³å¥ï¼Œè€Œä¸”ï¼Œåˆ†ä½æ•°å›å½’å¯¹è¯¯å·®é¡¹å¹¶ä¸è¦æ±‚å¾ˆå¼ºçš„å‡è®¾æ¡ä»¶ï¼Œå› æ­¤å¯¹äºéæ­£æ€åˆ†å¸ƒè€Œè¨€ï¼Œåˆ†ä½æ•°å›å½’ç³»æ•°ä¼°è®¡é‡åˆ™æ›´åŠ ç¨³å¥ã€‚ï¼›
4. ç”±åˆ†ä½å›å½’è§£å‡ºçš„ç³»åˆ—å›å½’æ¨¡å‹å¯æ›´ä¸ºå…¨é¢åœ°ä½“ç°åˆ†å¸ƒç‰¹ç‚¹ã€‚


#### ï¼ˆ4ï¼‰ç”¨åˆ†ä½å›å½’æ–¹æ³•æ‹Ÿåˆå…‰ç›˜ä¸­çš„infant-birthweightæ•°æ®ï¼Œå¹¶è¿›è¡Œè§£é‡Šï¼

##### 1> æ•°æ®æ¢ç´¢æ€§åˆ†æ

infant-birthweightæ•°æ®åŒ…æ‹¬50000ä¸ªè§‚æµ‹å€¼ï¼Œå’Œ17ä¸ªå˜é‡ï¼Œåœ¨å›å½’ä¹‹å‰ï¼Œè§‚å¯Ÿæ•°æ®ç»“æ„åé¦–å…ˆå¯¹æ•°æ®è¿›è¡Œå¦‚ä¸‹å¯¹é¢„å¤„ç†ï¼š

```{r,warning=F,message=F}
library(quantreg)
dat<-read.csv("infant-birthweight.txt",sep=" ")

#birmonå…¨å–6ï¼Œå¯ä»¥åˆ é™¤
all(dat$birmon==6)

#å‘ç°æ•°æ®ä¸­tri.noneå˜é‡å…¨ä¸º0ï¼Œè‹¥åŠ å…¥æ¨¡å‹ä¼šå¯¼è‡´è®¾è®¡çŸ©é˜µéå¥‡å¼‚ï¼Œåº”è¯¥åˆ é™¤
sum(dat$tri.none)

#tri1+tri2+tri3+novisitåŠ èµ·æ¥æ’ç­‰äº1ï¼Œå­˜åœ¨å®Œå…¨å…±çº¿æ€§ï¼Œè€ƒè™‘åˆ é™¤novisit
all((dat$tri1+dat$tri2+dat$tri3+dat$novisit)==1)
```


1. idã€ranidååº”çš„æ˜¯è§‚æµ‹çš„ç¼–å·ï¼Œåœ¨å›å½’ä¸­ä¸èµ·ä½œç”¨ï¼Œè€ƒè™‘äºˆä»¥åˆ é™¤ï¼›
2. æ•°æ®ä¸­tri.noneå˜é‡å…¨ä¸º0ï¼Œè‹¥åŠ å…¥æ¨¡å‹ä¼šå¯¼è‡´è®¾è®¡çŸ©é˜µéå¥‡å¼‚ï¼Œäºˆä»¥åˆ é™¤ï¼›
3. birmonä¸­çš„å˜é‡å…¨éƒ¨å–6ï¼ŒåŒæ ·ä¼šå¯¼è‡´è®¾è®¡çŸ©é˜µéå¥‡å¼‚ï¼Œäºˆä»¥åˆ é™¤ï¼›
4. tri1+tri2+tri3+novisitåŠ èµ·æ¥æ’ç­‰äº1ï¼Œå­˜åœ¨å®Œå…¨å…±çº¿æ€§ï¼Œé€‰æ‹©åˆ é™¤å…¶ä¸­ä¸€ä¸ªï¼Œä¾‹å¦‚åˆ é™¤å˜é‡novisit

å®Œæˆç­›é€‰åï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæè¿°ç»Ÿè®¡

|          |    weight  |      black    |   married    |    boy     |  
|---------:|------------|---------------|--------------|------------|
| Min      | 240        |  0.0000       |   0.0000     |  0.0000    |
|1st Qu    | 3062       |  0.0000       |  0.0000      |  0.0000    |
|Median    | 3402       |  0.0000       |  1.0000      |  1.0000    |  
| Mean     |  3371      | 0.1628        |  0.7126      |  0.5158    |
|3rd Qu    |  3720      |  0.0000       |  1.0000      |  1.0000    |
|Max       |  6350      | 1.0000        |  1.0000      |  1.0000    |
|          |  **tri1**  |   **tri2**    | **tri3**     | **ed.hs**  |      
| Min      | 0.0000     |    0.0000     | 0.00000      | 0.000      |
|1st Qu    | 1.0000     |  0.0000       | 0.00000      | 0.000      |
|Median    | 1.0000     |   0.0000      | 0.00000      | 0.000      |
| Mean     |0.8429      |  0.1268       | 0.02228      | 0.349      |
|3rd Qu    |1.0000      | 0.0000        | 0.00000      | 1.000      |
|Max       |1.0000      | 1.0000        | 1.00000      | 1.000      |
|          |**ed.smcol**|**ed.col**     |**mom.age**   |  **smoke** |     
| Min      | 0.0000     | 0.000         | -9.0000      | 0.0000     |
|1st Qu    | 0.0000     | 0.000         | -4.0000      | 0.0000     |
|Median    | 0.0000     | 0.000         |  0.0000      | 0.0000     |
| Mean     |0.2426      | 0.249         | 0.4161       | 0.1307     |
|3rd Qu    |0.0000      | 0.000         | 5.0000       | 0.0000     |
|Max       |1.0000      | 1.000         | 18.0000      | 1.0000     |
|          |**cigsper** | **m.wtgain**  | **mom.age2**|**m.wtgain2**|     
| Min      | 0.000      | -30.0000      |   0.00       |   0.0      | 
|1st Qu    | 0.000      | -8.0000       |   4.00       |  16.0      |
|Median    | 0.000      |   0.0000      | 16.00        |  64.0      |
| Mean     | 1.477      |   0.7092      |  32.99       |  166.3     |
|3rd Qu    | 0.000      |   9.0000      | 49.00        |  196.0     |
|Max       | 60.000     |  68.0000      | 324.00       |  4624.0    |

##### 2> åˆæ­¥å»ºæ¨¡

åœ¨å®Œæˆé¢„å¤„ç†åï¼Œä½¿ç”¨åŒ…`quantreg`å¯¹æ•°æ®è¿›è¡Œ$\tau=0.1,\ 0.2,...,0.9$åˆ†ä½æ•°å›å½’ï¼Œç»“æœå¦‚ä¸‹ï¼š

```{r,warning=F,message=F}
#å»é™¤idä¸ranidé¡¹ï¼Œä»¥åŠbirmon, tri.nonr, novisit
dat<-dat[,-c(1,2,10,11,21)]

f<-rq(weight~.,data=dat,tau=seq(0.1,0.9,0.1))
summary(f)
```

é¦–å…ˆåˆ†ææ¨¡å‹æ˜¾è‘—æ€§ï¼Œåœ¨å„ä¸ªåˆ†ä½æ•°å›å½’æ¨¡å‹ä¸­ï¼Œæ˜¾è‘—æ€§æ€»ä½“æ¥è¯´éƒ½è¾ƒä½³ã€‚åœ¨å¤§éƒ¨åˆ†çš„åˆ†ä½æ•°ä¸‹ï¼Œåˆ†ä½æ•°å›å½’çš„ç³»æ•°ï¼Œä½†ä¸ªåˆ«åˆ†ä½æ•°ï¼Œå­˜åœ¨ä¸ªåˆ«å˜é‡ä¸æ˜¾è‘—ï¼Œå¦‚`m.wtgain2`åœ¨æŸäº›åˆ†ä½æ•°ä¸‹på€¼è¿‡é«˜ç­‰ã€‚

æ­¤å¤–ï¼Œç›¸æ¯”0.8åˆ†ä½æ•°ä¸‹æ¨¡å‹æ‰€æœ‰ç³»æ•°å…¨éƒ¨æ˜¾è‘—çš„æƒ…å†µï¼Œå¯¹äº0.9åˆ†ä½æ•°ä¸‹çš„æ¨¡å‹ï¼Œå›å½’ç³»æ•°çš„æ˜¾è‘—æ€§ä¸‹é™è¾ƒå¤šï¼Œå¯èƒ½çš„åŸå› æ˜¯å¤–ä¾§çš„åˆ†ä½æ•°å›å½’ææ˜“å—æç«¯å€¼çš„å½±å“ï¼Œå¯¼è‡´å›å½’ä¸å¦‚åˆ†ä½æ•°å–å€¼é€‚ä¸­çš„æ¨¡å‹ç¨³å¥ã€‚

##### 3> èµ¤æ± ä¿¡æ¯é‡å‡†åˆ™ï¼ˆAICï¼‰


èµ¤æ± ä¿¡æ¯é‡å‡†åˆ™å»ºç«‹åœ¨ç†µçš„æ¦‚å¿µåŸºç¡€ä¸Šï¼Œå¯ä»¥æƒè¡¡æ‰€ä¼°è®¡æ¨¡å‹çš„å¤æ‚åº¦å’Œæ­¤æ¨¡å‹æ‹Ÿåˆæ•°æ®çš„ä¼˜è‰¯æ€§ï¼Œå…¶ä¸­$L$æ˜¯ä¼¼ç„¶å‡½æ•°ã€‚

$$AIC=-2ln(L)+2k$$

å¯¹äºè¿™ä¹ä¸ªåˆ†ä½æ•°ï¼Œè®¡ç®—å„è‡ªçš„AICå€¼ï¼ŒAICå€¼è¶Šå°çš„æ¨¡å‹æ‹Ÿåˆè¶Šä½³ã€‚å¯ä»¥çœ‹åˆ°ç»“æœä¸æˆ‘ä»¬çš„é¢„æœŸç›¸ç¬¦ï¼Œå¯¹äº0.5åˆ†ä½æ•°çš„AICå€¼æœ€å¥½æœ€ç¨³å¥ï¼Œå¯¹äºåˆ†ä½æ•°å–è¾ƒå¤§æˆ–è¾ƒå°çš„æ¨¡å‹AICå€¼è¾ƒé«˜ï¼Œæ‹Ÿåˆç•¥å·®ã€‚

```{r,warning=F,message=F}
aic=AIC(f)
plot(seq(0.1,0.9,0.1),aic,xlab="Ï„",ylab="AIC")
```

å› æ­¤ä»¥0.5åˆ†ä½æ•°ä¹‹ä¸‹çš„æ¨¡å‹ä¸ºä¾‹ï¼Œåˆ†æå„å˜é‡å¯¹äºè¢«è§£é‡Šå˜é‡çš„å½±å“ï¼š


$$\hat y_{(0.5)}=3217.33917-175.02032black+54.94456married +121.63809boy +107.94182tri1+105.30297tri2+103.34455tri3+15.95897ed.hs+29.45544ed.smcol+37.86871ed.col+7.09684 mom.age-0.35874mom.age^2-158.11346smoke-3.70373cigsper+7.03974m.wtgain+0.02142m.wtgain^2$$

```{r,messgae=F,warning=F}
f0.5=rq(weight~.,data=dat,tau=0.5)
summary(f0.5)
```


æ¨¡å‹çš„æ˜¾è‘—æ€§ååˆ†è‰¯å¥½ï¼Œæ¨¡å‹æ‰€æœ‰å˜é‡çš„ç³»æ•°å‡åœ¨5%ä¹‹ä¸‹æ˜¾è‘—ï¼Œæ¥ä¸‹æ¥è€ƒå¯Ÿæ­¤æ¨¡å‹çš„æ‹Ÿåˆä¼˜åº¦

##### 3> æ‹Ÿåˆä¼˜åº¦ï¼ˆGoodness-of-Fitï¼‰

å¯¹äºæ¨¡å‹çš„æ‹Ÿåˆä¼˜åº¦ï¼ŒKoenker ä¸ Machadoæå‡ºäº†è¡¡é‡æ‹Ÿåˆä¼˜åº¦çš„æŒ‡æ ‡$ğ‘…^1$ï¼Œç±»ä¼¼äºOLSçš„æ‹Ÿåˆä¼˜åº¦$R^2$ï¼Œå€¼è¶Šæ¥è¿‘1åˆ™æ‹Ÿåˆè¶Šä½³ã€‚

å®šä¹‰$V(\tau)=\min_b \sum\rho_\tau(y_i-x^T_ib)$ï¼Œå®šä¹‰$\hat\beta(\tau)$ä¸$\tilde\beta(\tau)$åˆ†åˆ«ä»£è¡¨å…¨æ¨¡å‹ä¸çº¦æŸæ¨¡å‹ï¼ˆé€šå¸¸æ˜¯åªåŒ…å«æˆªè·çš„æ¨¡å‹ï¼‰çš„åˆ†ä½æ•°å›å½’ç³»æ•°çš„ä¼°è®¡ï¼Œ$\hat V$ä¸$\tilde V$åˆ†åˆ«ä»£è¡¨å…¨æ¨¡å‹ä¸çº¦æŸæ¨¡å‹çš„$V$å€¼ï¼ŒKoenker ä¸ Machadoå®šä¹‰çš„æ‹Ÿåˆä¼˜åº¦ä¸º$$R^1=1-\frac {\hat V}{ \tilde V}$$

å¯è§æ¨¡å‹çš„$R^1$å¾ˆé«˜ï¼Œè¾¾åˆ°äº†0.88ä»¥ä¸Šï¼Œè¡¨æ˜æ¨¡å‹æ‹Ÿåˆå¾ˆå¥½ã€‚

```{r,warning=F,message=F}
rho <- function(u,tau=.5)u*(tau - (u < 0))
V <- function(resid,tau){sum(rho(resid, tau))}
R<- function(resid,tau){
  f0=rq(weight~0,data=dat,tau=tau)
  1-V(resid,tau)/V(f0$resid,f0$tau)}

R(f0.5$resid,0.5)
```

å‚è€ƒæ–‡çŒ®ï¼š

[1] Koenker, R and Machado, J (1999),


##### 4> æ¨¡å‹è§£é‡Š

|  (Intercept)   |      black      |   married   |      boy    |      tri1  |    tri2    |
|----------------|-----------------|-------------|-------------|------------|------------|
|  3217.339***   |  -175.020***    | 54.94***    |  121.638*** |  107.942***|  105.303** |
| **tri3**       |     **ed.hs**   | **ed.smcol**|**ed.col**   |**mom.age** | **smoke**  |
|  103.345**     | 15.959*         |  29.455**   |   37.869*** |  7.097***  | -158.113   |
|    **cigsper **|   **m.wtgain**  |**mom.age2** |**m.wtgain2**|            |            |
| -3.704**       |  7.040**        |-0.359**     | 0.0214*     |            |            | 

åˆ†ææ¨¡å‹çš„ç³»æ•°ï¼Œç”±äºç³»æ•°å…¨éƒ¨æ˜¾è‘—ï¼Œé‚£ä¹ˆå¯¹äºæ–°ç”Ÿå„¿ä½“é‡çš„ä¸­ä½æ•°æ¥è¯´ï¼Œé»‘äººã€æ¯äº²å¸çƒŸè¡Œä¸ºã€æ¯å¤©å¸çƒŸæ ¹æ•°`cigsper`çš„å¢åŠ éƒ½æ˜¯å¯¼è‡´å…¶ä¸‹é™çš„é‡è¦å› ç´ ã€‚ä¾‹å¦‚ï¼š

* æ§åˆ¶å…¶ä»–æ¡ä»¶ï¼Œé»‘äººæ¯äº²çš„å©´å„¿å¹³å‡æ¯”ç™½äººæ¯äº²çš„å©´å„¿è¦è½»175å…‹ï¼›
* æ§åˆ¶å…¶ä»–æ¡ä»¶ï¼Œå¸çƒŸæ¯äº²çš„å©´å„¿å¹³å‡æ¯”ä¸å¸çƒŸæ¯äº²çš„å©´å„¿è¦è½»158å…‹ï¼›
* æ§åˆ¶å…¶ä»–æ¡ä»¶ï¼Œæ¯äº²æ¯å¤©å¸çƒŸå¢åŠ ä¸€æ”¯ï¼Œæ–°ç”Ÿå„¿ä½“é‡å¹³å‡ä¸‹é™3.7å…‹ã€‚

é™¤å¹³æ–¹é¡¹å½¢å¼çš„`mom.age`ä¸`m.wtgain`å¤–ï¼Œå…¶ä»–å› ç´ çš„ç³»æ•°éƒ½æ˜¾è‘—ä¸ºæ­£ï¼Œå°è¯äº†è¿™äº›å˜é‡å¯¹äºæ–°ç”Ÿå„¿ä½“é‡çš„æ­£å‘å½±å“ï¼š

* å·²å©šæ¯äº²çš„å©´å„¿å¹³å‡æ¯”ç™½äººæ¯äº²çš„å©´å„¿è¦å¤š55å…‹
* ç”·å©´æ¯”å¥³å©´é‡122å…‹ï¼›

å¯¹äºä¸¤ä¸ªå¹³æ–¹é¡¹ï¼Œ

* é¦–å…ˆçœ‹`mom.age`ï¼Œä¸€é˜¶ç³»æ•°ä¸ºæ­£ï¼ŒäºŒé˜¶ç³»æ•°ä¸ºè´Ÿï¼Œè¡¨æ˜å©´å„¿ä½“é‡éšå¦ˆå¦ˆçš„å¹´é¾„å¢åŠ å…ˆä¸Šå‡åä¸‹é™
* `m.wtgain`ä¸€é˜¶ä¸äºŒé˜¶é¡¹å‡ä¸ºæ­£ï¼Œå¯è§å­•æœŸæ¯äº²ä½“é‡å¢åŠ è¶Šå¤šï¼Œå©´å„¿ä½“é‡ä¹Ÿè¶Šå¤§

åˆ†æ`tril`ç³»åˆ—å˜é‡ï¼Œ

* å®ƒè¡¨æ˜ä»åˆæœŸå¦Šå¨ ï¼Œåˆ°ä¸­æœŸå¦Šå¨ å†åˆ°æ™šæœŸå¦Šå¨ ï¼Œå©´å„¿çš„ä½“é‡æ˜¯é€æ¸ä¸‹é™çš„

æœ€åæ˜¯æ•™è‚²ç³»åˆ—å˜é‡

* è¯´æ˜ç›®å‰çš„å­¦å†ä»ä½äºé«˜ä¸­ï¼Œåˆ°é«˜ä¸­å­¦å†ï¼Œåˆ°some collegeï¼Œå†åˆ°collegeæ¯•ä¸šï¼Œå©´å„¿çš„ä½“é‡ä¾æ¬¡æ˜¾è‘—å¢åŠ ã€‚




### æ–°æ•™æ6.9 æ¨¡æ‹Ÿå®éªŒåˆ†æï¼š$(X,Z)$çš„çœŸå®å…³ç³»æ»¡è¶³$z=2(exp(â€”30Â·(x-0.25)^2)+sin(\pi x^2))$ã€‚ä»å‡åŒ€åˆ†å¸ƒ$U(0ï¼Œ1)$ä¸­æŠ½å–100ä¸ª$X$å€¼ï¼Œå°†è¿™äº›æ•°å€¼ä»å°åˆ°å¤§æ’åºï¼Œä¾æ¬¡äº§ç”Ÿå¸¦æœ‰$N(0ï¼Œ1)$å™ªå£°çš„$Y$å€¼ï¼Œå³ï¼š$y=z+N(0,1)$ã€‚è¿™æ ·çš„å®éªŒé‡å¤20æ¬¡ï¼Œå¾—åˆ°$(X,Y)$è§‚æµ‹å€¼çŸ©é˜µå’ŒçœŸå€¼çŸ©é˜µ$(X,Z)$,å®Œæˆä»¥ä¸‹åˆ†æä»»åŠ¡ï¼š

#### (1)ç»˜åˆ¶$(X,Y)$çš„æ•£ç‚¹å›¾ï¼Œå¹¶åœ¨æ•£ç‚¹å›¾ä¸Šæ·»åŠ ç”±$(X,Z)$ç”Ÿæˆçš„çœŸå®å‡½æ•°æ›²çº¿ï¼›

```{r,warning=F,message=F}
#å‡åŒ€åˆ†å¸ƒ$U(0ï¼Œ1)$ä¸­æŠ½å–100ä¸ª$X$å€¼
n=100
set.seed(3434384)
X=runif(n)

#å°†è¿™äº›æ•°å€¼ä»å°åˆ°å¤§æ’åº
X=sort(X)

#ä¾æ¬¡äº§ç”Ÿå¸¦æœ‰$N(0ï¼Œ1)$å™ªå£°çš„$Y$å€¼ï¼Œå³ï¼š$y=z+N(0,1)$
Z=2*(exp(-30*(X-0.25^2))+sin(pi*X^2))
Y=Z+rnorm(n)

#ç»˜åˆ¶$(X,Y)$çš„æ•£ç‚¹å›¾
plot(X,Y)

#å¹¶åœ¨æ•£ç‚¹å›¾ä¸Šæ·»åŠ ç”±$(X,Z)$ç”Ÿæˆçš„çœŸå®å‡½æ•°æ›²çº¿
XX=seq(0,1,.01)
ZZ=2*(exp(-30*(XX-0.25^2))+sin(pi*XX^2))
lines(XX,ZZ,lty=2)


```


#### ï¼ˆ2ï¼‰æ±‚è§£ä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’å’Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œå’Œä¸å¸¦å™ªå£°çš„çœŸå®å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¼°è®¡æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®ï¼›

é¦–å…ˆè¿›è¡Œä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°ç›´æ¥æ±‚å¾—äº†ä¸­ä½æ•°çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{med}(x)=1.18412+0.27329x$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
æ³¨æ„ï¼Œè¿›è¡Œæ¯”è¾ƒçš„æ˜¯ä¸å¸¦å™ªå£°çš„åŸå§‹æ•°æ®$Z$ï¼Œè€Œä¸æ˜¯å¸¦å™ªå£°çš„$Y$ã€‚å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{med}=3.372061$$
```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
fmed=rq(Y~X,tau=0.5)
summary(fmed)
mean((predict(fmed)-Z)^2)
```

å…¶æ¬¡è¿›è¡Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°æ±‚å¾—å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{low}(x)=0.32309+0.39764x$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}=4.527782$$é«˜äºä¸­ä½æ•°å›å½’ã€‚

```{r,warning=F,message=F}
#0.25åˆ†ä½æ•°çº¿æ€§å›å½’
flow=rq(Y~X,tau=0.25)
summary(flow)
mean((predict(flow)-Z)^2)
```
æœ€åè¿›è¡Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼š$$\hat Y_{low}(x)=2.79747-0.66313x$$

å¯ä»¥è®¡ç®—å¾—åˆ°0.75ä½ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}=3.813042$$ä¹Ÿä¸å¦‚ä¸­ä½æ•°å›å½’ã€‚
```{r,warning=F,message=F}

#0.75åˆ†ä½æ•°çº¿æ€§å›å½’
fhig=rq(Y~X,tau=0.75)
summary(fhig)
mean((predict(fhig)-Z)^2)
```

ç»¼ä¸Šï¼Œä»$MSE$è§’åº¦æ¥çœ‹ï¼Œä¸­ä½æ•°å›å½’æ‹Ÿåˆæ›´å¥½ï¼Œ$MSE$æ›´ä½ã€‚ä¸‹é¢é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ä¸‰ç§æ‹Ÿåˆéƒ½ä¸æ˜¯å¾ˆç†æƒ³ï¼Œå®ƒä»¬æ›´åå‘äº$X$å–0.2ï½1ä¹‹é—´æ•£ç‚¹çš„ä¿¡æ¯ï¼Œå¯¹äºå›¾åƒå·¦ä¸Šè§’çš„æ•£ç‚¹æ‹Ÿåˆå¾ˆå·®ã€‚

```{r,warning=F,message=F}
par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
abline(fmed,col="red")
abline(flow,col="blue")
abline(fhig,col="green")
legend("topright",c("ä¸­ä½æ•°","0.25åˆ†ä½æ•°","0.75åˆ†ä½æ•°","çœŸå®æ›²çº¿"),col=c("red","blue","green","black"),lty=c(1,1,1,2))
```

#### ï¼ˆ3ï¼‰å°†çº¿æ€§å›å½’æ”¹ä¸ºå¤šé¡¹å¼ä¸ºäºŒé˜¶è¡¨ç¤ºå‹ï¼ˆæ¨¡å‹ä¸­çº³å…¥$X^2$é¡¹ï¼‰å’Œå››é˜¶ï¼ˆæ¨¡å‹ä¸­çº³å…¥$X^2$,$X^3$,$X^4$é¡¹ï¼‰ï¼Œç»§ç»­æ‹Ÿåˆæ•°æ®ï¼Œæ¯”è¾ƒï¼ˆ2ï¼‰å’Œï¼ˆ3ï¼‰æ‹Ÿåˆçš„ç»“æœæœ‰æ€æ ·çš„ä¸åŒï¼›

##### 1> äºŒé˜¶è¡¨ç¤ºå‹


è¿›è¡Œä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°ç›´æ¥æ±‚å¾—äº†ä¸­ä½æ•°çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{med}(x)=0.87906+2.21020x-2.31862x^2$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{med}=3.625185$$å‡æ–¹è¯¯å·®æ²¡æœ‰å¾—åˆ°å¾ˆæ˜æ˜¾çš„ä¸‹é™ã€‚
```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
X2=X^2
fmed=rq(Y~X+X2,tau=0.5)
summary(fmed)
mean((predict(fmed)-Z)^2)
```

å…¶æ¬¡è¿›è¡Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°æ±‚å¾—å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{low}(x)=-0.34496+3.85942x-3.47371x^2$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°0.25ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}=5.16927$$åŒæ ·åœ°ï¼ŒMSEæ²¡æœ‰å¾—åˆ°é™ä½ã€‚

```{r,warning=F,message=F}
#0.25åˆ†ä½æ•°çº¿æ€§å›å½’
flow=rq(Y~X+X2,tau=0.25)
summary(flow)
mean((predict(flow)-Z)^2)
```
æœ€åè¿›è¡Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼š$$\hat Y_{low}(x)=4.28078-8.10778x+7.12867x^2$$

å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{high}=3.542667$$ï¼Œåœ¨ä¸‰ç§å›å½’ä¸­æœ€å°ï¼Œæ‹Ÿåˆçš„æ›²çº¿æœ€å¥½ã€‚

```{r,warning=F,message=F}

#0.75åˆ†ä½æ•°çº¿æ€§å›å½’
fhig=rq(Y~X+X2,tau=0.75)
summary(fhig)
mean((predict(fhig)-Z)^2)
```

ç»¼ä¸Šï¼Œä»$MSE$è§’åº¦æ¥çœ‹ï¼Œ0.75åˆ†ä½æ•°å›å½’æ‹Ÿåˆæ›´å¥½ï¼Œ$MSE$æ›´ä½ï¼Œå› ä¸ºå®ƒå…¼é¡¾äº†åˆ†ä½è¾ƒé«˜çš„ç‚¹ï¼ŒåŒ…æ‹¬ä¸‹å›¾ä¸­å·¦ä¸Šè§’çš„é‚£äº›ç‚¹ã€‚ä¸‹é¢é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ç§æ‹Ÿåˆä»ç„¶ä¸æ˜¯å¾ˆç†æƒ³ï¼Œå¯¹äºå›¾åƒå·¦ä¸Šè§’çš„æ•£ç‚¹æ‹Ÿåˆä»ç„¶ååˆ†åœ°å·®ã€‚

ä½†ç›¸æ¯”ï¼ˆ2ï¼‰ä¸­ä½¿ç”¨ç›´çº¿æ‹Ÿåˆï¼Œå¯¹äºå›¾ä¸Šå·¦ä¸Šè§’çš„æ•£ç‚¹æœ‰äº†ä¸€å®šçš„æ‹Ÿåˆè¶‹åŠ¿ã€‚

```{r,warning=F,message=F}
par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
lines(XX,coef(fmed)[1]+coef(fmed)[2]*XX+coef(fmed)[3]*XX^2,col="red")
lines(XX,coef(flow)[1]+coef(flow)[2]*XX+coef(flow)[3]*XX^2,col="blue")
lines(XX,coef(fhig)[1]+coef(fhig)[2]*XX+coef(fhig)[3]*XX^2,col="green")
legend("topright",c("ä¸­ä½æ•°","0.25åˆ†ä½æ•°","0.75åˆ†ä½æ•°","çœŸå®æ›²çº¿"),col=c("red","blue","green","black"),lty=c(1,1,1,2))
```

##### 2> å››é˜¶è¡¨ç¤ºå‹


è¿›è¡Œä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°ç›´æ¥æ±‚å¾—äº†ä¸­ä½æ•°çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{med}(x)=6.06272-64.09093x+220.79924x^2-272.10382x^3+109.33261x^4$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{med}=0.9558599$$å‡æ–¹è¯¯å·®å¾—åˆ°äº†å¾ˆæ˜¾è‘—çš„ä¸‹é™ã€‚
```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
X3=X^3;X4=X^4
fmed=rq(Y~X+X2+X3+X4,tau=0.5)
summary(fmed)
mean((predict(fmed)-Z)^2)
```

å…¶æ¬¡è¿›è¡Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°æ±‚å¾—å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{low}(x)=2.88355-39.92793x+143.25446x^2-177.84004x^3+71.50042x^4$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}=2.788887$$0.25åˆ†ä½æ•°çš„MSEæ²¡æœ‰å¾—åˆ°é™ä½ã€‚

```{r,warning=F,message=F}
#0.25åˆ†ä½æ•°çº¿æ€§å›å½’
flow=rq(Y~X+X2+X3+X4,tau=0.25)
summary(flow)
mean((predict(flow)-Z)^2)
```
æœ€åè¿›è¡Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼š$$\hat Y_{low}(x)=10.38074  -81.66619 x+239.31751 x^2 -263.70010x^3+95.95471x^4$$

å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{high}=2.287524$$ï¼Œä¼˜äº0.25åˆ†ä½æ•°ä½†ä¸åŠä¸­ä½æ•°ã€‚

```{r,warning=F,message=F}

#0.75åˆ†ä½æ•°çº¿æ€§å›å½’
fhig=rq(Y~X+X2+X3+X4,tau=0.75)
summary(fhig)
mean((predict(fhig)-Z)^2)
```

ç»¼ä¸Šï¼Œä»$MSE$è§’åº¦æ¥çœ‹ï¼Œä¸­ä½æ•°å›å½’æ‹Ÿåˆæ›´å¥½ï¼Œ$MSE$è¾¾åˆ°æœ€ä½ï¼Œå› ä¸ºå®ƒå…¼é¡¾äº†åˆ†ä½è¾ƒé«˜çš„ç‚¹ï¼ŒåŒ…æ‹¬ä¸‹å›¾ä¸­å·¦ä¸Šè§’çš„é‚£äº›ç‚¹ã€‚ä¸‹é¢é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ï¼Œä¹Ÿå°è¯ä¸­ä½æ•°æ›²çº¿æ‹Ÿåˆçš„ç»“æœã€‚

**å› æ­¤åœ¨æœ¬é¢˜çš„å„ç§æ‹Ÿåˆæ–¹æ³•ä¸­ï¼Œå››é˜¶è¡¨ç¤ºå‹çš„ä¸­ä½æ•°å›å½’æ•ˆæœæœ€ä½³**ã€‚

```{r,warning=F,message=F}
par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
lines(XX,coef(fmed)[1]+coef(fmed)[2]*XX+coef(fmed)[3]*XX^2+coef(fmed)[4]*XX^3+coef(fmed)[5]*XX^4,col="red")
lines(XX,coef(flow)[1]+coef(flow)[2]*XX+coef(flow)[3]*XX^2+coef(flow)[4]*XX^3+coef(flow)[5]*XX^4,col="blue")
lines(XX,coef(fhig)[1]+coef(fhig)[2]*XX+coef(fhig)[3]*XX^2+coef(fhig)[4]*XX^3+coef(fhig)[5]*XX^4,col="green")
legend("topright",c("ä¸­ä½æ•°","0.25åˆ†ä½æ•°","0.75åˆ†ä½æ•°","çœŸå®æ›²çº¿"),col=c("red","blue","green","black"),lty=c(1,1,1,2))
```


æ ¹æ®å¤šé¡¹å¼çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæƒ³ï¼Œä½¿ç”¨æ›´é«˜é˜¶çš„å¤šé¡¹å¼è¿›è¡Œä¸­ä½æ•°æ‹Ÿåˆï¼Œå¯ä»¥å¾—åˆ°æ›´ä½³çš„æ‹Ÿåˆç»“æœã€‚è¿™é‡Œå°è¯•äº”é˜¶å’Œå…­é˜¶ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ5é˜¶æ˜æ˜¾æ¯”4é˜¶æ‹Ÿåˆæ›´å¥½ï¼Œä½†ä¸Šå‡åˆ°6é˜¶ä¼šå­˜åœ¨è¿‡æ‹Ÿåˆã€‚

```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
X5=X^5;X6=X^6
f6=rq(Y~X+X2+X3+X4+X5+X6,tau=0.5)
f5=rq(Y~X+X2+X3+X4+X5,tau=0.5)
list(mean((predict(f5)-Z)^2),mean((predict(f6)-Z)^2))

par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
lines(XX,coef(f5)[1]+coef(f5)[2]*XX+coef(f5)[3]*XX^2+coef(f5)[4]*XX^3+coef(f5)[5]*XX^4+coef(f5)[6]*XX^5,col="red")
lines(XX,coef(f6)[1]+coef(f6)[2]*XX+coef(f6)[3]*XX^2+coef(f6)[4]*XX^3+coef(f6)[5]*XX^4+coef(f6)[6]*XX^5+coef(f6)[7]*XX^6,col="orange")
legend("topright",c("5é˜¶ä¸­ä½æ•°å›å½’","6é˜¶ä¸­ä½æ•°å›å½’","çœŸå®æ›²çº¿"),col=c("red","orange","black"),lty=c(1,1,2))
```

#### ï¼ˆ4ï¼‰æ”¹å˜$Y$å€¼çš„ç”Ÿæˆæ–¹å¼ï¼š$y=2(exp(â€”30(x-0.25)^2)+sin(\pi x^2))+N(0,(2x)^2)$å†…æ±‚è§£å¤šé¡¹å¼ä¸ºäºŒé˜¶ï¼ˆ$X^2$ï¼‰å’Œå››é˜¶ï¼ˆ$X^2$,$X^3$,$X^4$ï¼‰çš„ä¸­ä½æ•°ã€0.25åˆ†ä½æ•°ã€0.75åˆ†ä½å›å½’ï¼Œå°†è¿™äº›æ‹Ÿåˆçº¿ç»˜åˆ¶åˆ°æ•£ç‚¹å›¾ä¸Šã€‚æ¯”è¾ƒï¼ˆ2ï¼‰ï¼ˆ3ï¼‰ï¼ˆ4ï¼‰çš„æ•°æ®åˆ†æï¼Œç»™å‡ºè®¨è®ºã€‚

è¿™é‡Œé‡æ–°ç”Ÿæˆæ•°æ®ï¼Œä»å›¾ä¸­ä¸éš¾çœ‹åˆ°ï¼Œæ•£ç‚¹åœ¨çœŸå€¼å‘¨å›´çš„åˆ†å¸ƒéšç€$X$çš„å¢å¤§è¶Šæ¥è¶Šç¦»æ•£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```{r,warning=F,message=F}
#å‡åŒ€åˆ†å¸ƒ$U(0ï¼Œ1)$ä¸­æŠ½å–100ä¸ª$X$å€¼
n=100
set.seed(3434384)
X=runif(n)

#å°†è¿™äº›æ•°å€¼ä»å°åˆ°å¤§æ’åº
X=sort(X)

#ä¾æ¬¡äº§ç”Ÿå¸¦æœ‰$N(0ï¼Œ1)$å™ªå£°çš„$Y$å€¼ï¼Œå³ï¼š$y=z+N(0,1)$
Z=2*(exp(-30*(X-0.25^2))+sin(pi*X^2))
Y=Z+rnorm(n,sd=2*X)

#ç»˜åˆ¶$(X,Y)$çš„æ•£ç‚¹å›¾
plot(X,Y)

#å¹¶åœ¨æ•£ç‚¹å›¾ä¸Šæ·»åŠ ç”±$(X,Z)$ç”Ÿæˆçš„çœŸå®å‡½æ•°æ›²çº¿
XX=seq(0,1,.01)
ZZ=2*(exp(-30*(XX-0.25^2))+sin(pi*XX^2))
lines(XX,ZZ,lty=2)


```

##### 1> ä¸€é˜¶è¡¨ç¤ºå‹


é¦–å…ˆè¿›è¡Œä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°ç›´æ¥æ±‚å¾—äº†ä¸­ä½æ•°çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{med}(x)= 1.14941-0.03452x$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{med}=3.439844$$
```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
fmed=rq(Y~X,tau=0.5)
summary(fmed)
mean((predict(fmed)-Z)^2)
```

å…¶æ¬¡è¿›è¡Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°æ±‚å¾—å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{low}(x)=0.64108-0.37092 x$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}=4.482389$$é«˜äºä¸­ä½æ•°å›å½’ã€‚

```{r,warning=F,message=F}
#0.25åˆ†ä½æ•°çº¿æ€§å›å½’
flow=rq(Y~X,tau=0.25)
summary(flow)
mean((predict(flow)-Z)^2)
```
æœ€åè¿›è¡Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼š$$\hat Y_{low}(x)=2.08818 + 0.55543  x$$

å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{high}=3.920418$$é«˜äºä¸­ä½æ•°å›å½’ï¼Œä½†ä¸0.25åˆ†ä½æ•°ç›¸å½“ã€‚
```{r,warning=F,message=F}

#0.75åˆ†ä½æ•°çº¿æ€§å›å½’
fhig=rq(Y~X,tau=0.75)
summary(fhig)
mean((predict(fhig)-Z)^2)
```

ç»¼ä¸Šï¼Œä»$MSE$è§’åº¦æ¥çœ‹ï¼Œä¸­ä½æ•°å›å½’æ‹Ÿåˆæ›´å¥½ï¼Œ$MSE$æ›´ä½ã€‚ä¸‹é¢é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ä¸‰ç§æ‹Ÿåˆéƒ½ä¸æ˜¯å¾ˆç†æƒ³ï¼Œå‡ ä¹éƒ½æ˜¯æ°´å¹³çº¿ï¼Œå¯¹äºå›¾åƒå·¦ä¸Šè§’çš„æ•£ç‚¹ä¿¡æ¯æ²¡æœ‰ä»»ä½•åå‘ã€‚

```{r,warning=F,message=F}
par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
abline(fmed,col="red")
abline(flow,col="blue")
abline(fhig,col="green")
legend("topright",c("ä¸­ä½æ•°","0.25åˆ†ä½æ•°","0.75åˆ†ä½æ•°","çœŸå®æ›²çº¿"),col=c("red","blue","green","black"),lty=c(1,1,1,2))
```

##### 2> äºŒé˜¶è¡¨ç¤ºå‹


è¿›è¡Œä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°ç›´æ¥æ±‚å¾—äº†ä¸­ä½æ•°çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{med}(x)=0.69175 + 2.12554 x -2.01556 x^2$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{med}=3.761927$$å‡æ–¹è¯¯å·®æ²¡æœ‰å¾—åˆ°å¾ˆæ˜æ˜¾çš„ä¸‹é™ã€‚
```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
X2=X^2
fmed=rq(Y~X+X2,tau=0.5)
summary(fmed)
mean((predict(fmed)-Z)^2)
```

å…¶æ¬¡è¿›è¡Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°æ±‚å¾—å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{low}(x)= 0.22807  + 1.93747 x -2.45845 x^2$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}=4.920684$$åŒæ ·åœ°ï¼ŒMSEæ²¡æœ‰å¾—åˆ°é™ä½ã€‚

```{r,warning=F,message=F}
#0.25åˆ†ä½æ•°çº¿æ€§å›å½’
flow=rq(Y~X+X2,tau=0.25)
summary(flow)
mean((predict(flow)-Z)^2)
```
æœ€åè¿›è¡Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼š$$\hat Y_{low}(x)=3.36895-7.22886x+ 8.04999 x^2$$

å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{high}=3.539638$$ï¼Œåœ¨ä¸‰ç§å›å½’ä¸­æœ€å°ï¼Œæ‹Ÿåˆçš„æ›²çº¿æœ€å¥½ã€‚

```{r,warning=F,message=F}

#0.75åˆ†ä½æ•°çº¿æ€§å›å½’
fhig=rq(Y~X+X2,tau=0.75)
summary(fhig)
mean((predict(fhig)-Z)^2)
```

ç»¼ä¸Šï¼Œä»$MSE$è§’åº¦æ¥çœ‹ï¼Œ0.75åˆ†ä½æ•°å›å½’æ‹Ÿåˆæ›´å¥½ï¼Œ$MSE$æ›´ä½ï¼Œå› ä¸ºå®ƒå…¼é¡¾äº†åˆ†ä½è¾ƒé«˜çš„ç‚¹ï¼ŒåŒ…æ‹¬ä¸‹å›¾ä¸­å·¦ä¸Šè§’çš„é‚£äº›ç‚¹ã€‚ä¸‹é¢é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ç§æ‹Ÿåˆä»ç„¶ä¸æ˜¯å¾ˆç†æƒ³ï¼Œå¯¹äºå›¾åƒå·¦ä¸Šè§’çš„æ•£ç‚¹æ‹Ÿåˆä»ç„¶ååˆ†åœ°å·®ã€‚

```{r,warning=F,message=F}
par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
lines(XX,coef(fmed)[1]+coef(fmed)[2]*XX+coef(fmed)[3]*XX^2,col="red")
lines(XX,coef(flow)[1]+coef(flow)[2]*XX+coef(flow)[3]*XX^2,col="blue")
lines(XX,coef(fhig)[1]+coef(fhig)[2]*XX+coef(fhig)[3]*XX^2,col="green")
legend("topright",c("ä¸­ä½æ•°","0.25åˆ†ä½æ•°","0.75åˆ†ä½æ•°","çœŸå®æ›²çº¿"),col=c("red","blue","green","black"),lty=c(1,1,1,2))
```

##### 3> å››é˜¶è¡¨ç¤ºå‹


è¿›è¡Œä¸­ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°ç›´æ¥æ±‚å¾—äº†ä¸­ä½æ•°çº¿æ€§å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{med}(x)=5.58963-62.80620x+221.61071x^2 -276.47705x^3+111.71180x^4$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{med}=1.146304$$å‡æ–¹è¯¯å·®å¾—åˆ°äº†å¾ˆæ˜¾è‘—çš„ä¸‹é™ã€‚
```{r,warning=F,message=F}
#ä¸­ä½æ•°çº¿æ€§å›å½’
X3=X^3;X4=X^4
fmed=rq(Y~X+X2+X3+X4,tau=0.5)
summary(fmed)
mean((predict(fmed)-Z)^2)
```

å…¶æ¬¡è¿›è¡Œ0.25åˆ†ä½æ•°çº¿æ€§å›å½’ï¼Œåˆ©ç”¨å‰é¢˜æåˆ°è¿‡çš„`rq`å‡½æ•°æ±‚å¾—å›å½’è¡¨è¾¾å¼ï¼š$$\hat Y_{low}(x)= 4.78531-56.43084x+202.12547x^2 -263.16996x^3+112.38748x^4$$
å‡æ–¹è¯¯å·®çš„å…¬å¼ä¸º$$MSE=\sum_{i=1}^n(\hat Y(x)-Z(x))^2/n$$
å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{low}= 1.986502$$0.25åˆ†ä½æ•°çš„MSEæ²¡æœ‰å¾—åˆ°é™ä½ã€‚

```{r,warning=F,message=F}
#0.25åˆ†ä½æ•°çº¿æ€§å›å½’
flow=rq(Y~X+X2+X3+X4,tau=0.25)
summary(flow)
mean((predict(flow)-Z)^2)
```
æœ€åè¿›è¡Œ0.75åˆ†ä½æ•°çº¿æ€§å›å½’ï¼š$$\hat Y_{low}(x)=9.11817 -77.62363 x+236.28089 x^2 -261.78994x^3+    94.46553  x^4$$

å¯ä»¥è®¡ç®—å¾—åˆ°0.25åˆ†ä½æ•°çº¿æ€§å›å½’æ‹Ÿåˆçš„å‡æ–¹è¯¯å·®$$MSE_{high}=1.822718$$ï¼Œåœ¨ä¸‰ç§å›å½’ä¸­è¡¨ç°æœ€å·®ã€‚

```{r,warning=F,message=F}

#0.75åˆ†ä½æ•°çº¿æ€§å›å½’
fhig=rq(Y~X+X2+X3+X4,tau=0.75)
summary(fhig)
mean((predict(fhig)-Z)^2)
```

ç»¼ä¸Šï¼Œä»$MSE$è§’åº¦æ¥çœ‹ï¼Œä¸­ä½æ•°å›å½’æ‹Ÿåˆæ›´å¥½ï¼Œ$MSE$è¾¾åˆ°æœ€ä½ï¼Œå› ä¸ºå®ƒå…¼é¡¾äº†åˆ†ä½è¾ƒé«˜çš„ç‚¹ï¼ŒåŒ…æ‹¬ä¸‹å›¾ä¸­å·¦ä¸Šè§’çš„é‚£äº›ç‚¹ã€‚ä¸‹é¢é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ï¼Œçš„ç¡®æ˜¯ä¸­ä½æ•°æ›²çº¿æ‹Ÿåˆçš„æœ€å¥½ã€‚

```{r,warning=F,message=F}
par(family="PingFang SC")
plot(X,Y)
lines(XX,ZZ,lty=2)
lines(XX,coef(fmed)[1]+coef(fmed)[2]*XX+coef(fmed)[3]*XX^2+coef(fmed)[4]*XX^3+coef(fmed)[5]*XX^4,col="red")
lines(XX,coef(flow)[1]+coef(flow)[2]*XX+coef(flow)[3]*XX^2+coef(flow)[4]*XX^3+coef(flow)[5]*XX^4,col="blue")
lines(XX,coef(fhig)[1]+coef(fhig)[2]*XX+coef(fhig)[3]*XX^2+coef(fhig)[4]*XX^3+coef(fhig)[5]*XX^4,col="green")
legend("topright",c("ä¸­ä½æ•°","0.25åˆ†ä½æ•°","0.75åˆ†ä½æ•°","çœŸå®æ›²çº¿"),col=c("red","blue","green","black"),lty=c(1,1,1,2))
```




### æ•°æ®ï¼šR galaxies {MASS} æ•°æ®èƒŒæ™¯å¯å‚è€ƒè®ºæ–‡ Postman, M., Huchra, J. P. and Geller, M. J. (1986) Probes of large-scale structures in the Corona Borealis region. Astronomical Journal 92, 1238â€“1247.

#### è¯·ç”¨è¿™ä¸ªæ•°æ®å¯¹velocitiesçš„åˆ†å¸ƒå¯†åº¦å°è¯•ä¸åŒä¸ªçš„å¸¦å®½å’Œä¸åŒçš„æ ¸å‡½æ•°$\hat p_h(x)$ï¼ˆè‡³å°‘4ç§ï¼Œä»»æ„é€‰ï¼‰ä½œæ ¸ä¼°è®¡ï¼Œå¹¶ç»˜åˆ¶å‡ºæ¥ï¼Œå¯¹æ¯”å·®å¼‚ã€‚

ä½¿ç”¨Rè¯­è¨€é»˜è®¤ç¡®å®šçš„å¸¦å®½$h=1002$ï¼Œ

åˆ†åˆ«ä½¿ç”¨ä¸‰è§’æ ¸ã€Epanechnikovæ ¸ã€é«˜æ–¯æ ¸ä»¥åŠä½™å¼¦æ ¸ï¼Œç»˜å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™é‡Œå¸¦å®½é€‰æ‹©ä½¿ç”¨äº†Rè¯­è¨€è‡ªå¸¦çš„å‚æ•°`nrd`ï¼Œä»£è¡¨åˆ©ç”¨é«˜æ–¯æ ¸ä¼°è®¡å¸¦å®½ï¼Œè®¡ç®—å¾—åˆ°å¸¦å®½å¤§å°ä¸º1180ï¼š$$\hat h_0\approx 1.06\hat \sigma n^{(-1/5)}$$

```{r,warning=F,message=F}
library(MASS)
data(galaxies)

#ä¸‰è§’æ ¸
par(family="PingFang SC")
plot(density(galaxies,kernel="triangular",bw="nrd"),main="æ ¸å¯†åº¦ä¼°è®¡ï¼Œbw=nrd",col="red")

#Epanechnikovæ ¸
lines(density(galaxies,kernel="epanechnikov",bw="nrd"),col="blue")

#é«˜æ–¯æ ¸
lines(density(galaxies,kernel="gaussian",bw="nrd"),col="green")

#ä½™å¼¦æ ¸
lines(density(galaxies,kernel="cosine",bw="nrd"))
legend("topleft",c('ä¸‰è§’æ ¸','Epanechnikov','é«˜æ–¯æ ¸','ä½™å¼¦æ ¸'),col = c("red",'blue','green',"black"),lty=1)
```

ä½¿ç”¨`ucv`å³æ— åäº¤å‰éªŒè¯æ³•ç¡®å®šå¸¦å®½ï¼Œæ±‚å¾—$bw=626$ã€‚

```{r,warning=F,message=F}
#ä¸‰è§’æ ¸
par(family="PingFang SC")
plot(density(galaxies,kernel="triangular",bw="ucv"),main="æ ¸å¯†åº¦ä¼°è®¡ï¼Œbw=ucv",col="red")

#Epanechnikovæ ¸
lines(density(galaxies,kernel="epanechnikov",bw="ucv"),col="blue")

#é«˜æ–¯æ ¸
lines(density(galaxies,kernel="gaussian",bw="ucv"),col="green")

#ä½™å¼¦æ ¸
lines(density(galaxies,kernel="cosine",bw="ucv"))
legend("topleft",c('ä¸‰è§’æ ¸','Epanechnikov','é«˜æ–¯æ ¸','ä½™å¼¦æ ¸'),col = c("red",'blue','green',"black"),lty=1)
```


ä½¿ç”¨`SJ`è¡¨ç¤ºSheather & Jones (1991)æ³•ç¡®å®šå¸¦å®½ï¼Œæ±‚å¾—$bw=643$ï¼Œä¸æ— åäº¤å‰éªŒè¯æ³•ç»“æœåŸºæœ¬ä¸€è‡´ã€‚

```{r,warning=F,message=F}
#ä¸‰è§’æ ¸
par(family="PingFang SC")
plot(density(galaxies,kernel="triangular",bw="SJ"),main="æ ¸å¯†åº¦ä¼°è®¡ï¼Œbw=SJ",col="red")

#Epanechnikovæ ¸
lines(density(galaxies,kernel="epanechnikov",bw="SJ"),col="blue")

#é«˜æ–¯æ ¸
lines(density(galaxies,kernel="gaussian",bw="SJ"),col="green")

#ä½™å¼¦æ ¸
lines(density(galaxies,kernel="cosine",bw="SJ"))
legend("topleft",c('ä¸‰è§’æ ¸','Epanechnikov','é«˜æ–¯æ ¸','ä½™å¼¦æ ¸'),col = c("red",'blue','green',"black"),lty=1)
```

ç”»å‡ºå››ç§æ ¸å‡½æ•°çš„æ ¸å¯†åº¦ä¼°è®¡çš„å›¾åƒåï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°è¿™å››ç§æ ¸å‡½æ•°çš„å·®å¼‚æ‰€åœ¨ï¼š

å¯ä»¥çœ‹åˆ°ï¼Œå››ç§æ ¸å‡½æ•°çš„æ ¸å¯†åº¦ä¼°è®¡åŸºæœ¬ä¸€è‡´ï¼Œä½†ç‰¹åˆ«åœ¨æ‹ç‚¹å¤„å­˜åœ¨å·®å¼‚ï¼Œä¸‰è§’æ ¸ï¼ˆçº¢è‰²ï¼‰çš„è½¬æŠ˜ç‚¹æ›´å°–é”ï¼Œé«˜æ–¯æ ¸ä»¥åŠä½™å¼¦æ ¸å¯†åº¦ä¼°è®¡åˆ™æ¯”è¾ƒå¹³æ»‘ï¼›é«˜æ–¯æ ¸ï¼ˆç»¿è‰²ï¼‰åœ¨å‡¸ç‚¹å¤„å¯†åº¦è¾ƒå¤§ï¼Œåœ¨å‡¹ç‚¹å¤„å¯†åº¦è¾ƒå°ï¼›Epanechnikovæ ¸åœ¨æ‹ç‚¹å¤„å¹³æ»‘ï¼Œä½†åœ¨éæ‹ç‚¹å¤„è¾ƒæ‰­æ›²ä¸”ä¸ç¨³å®šã€‚


#### è¯·é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„$h$è¿›è¡Œå¦‚ä¸‹å®éªŒï¼šç”¨è¯¾å ‚ä¸Šè®²è¿‡çš„æ–¹æ³•å¯¹è¯¥æ•°æ®çš„$p_h(x)$é€šè¿‡bootstrapæ–¹æ³•è¿‘ä¼¼ç»™å‡ºç”±$\hat p_h(x)$æ„é€ çš„ç½®ä¿¡æ°´å¹³ä¸º$95\%$ç½®ä¿¡å¸¦ã€‚

ä½¿ç”¨SJæ³•ç¡®å®šçš„å¸¦å®½$h=643$è¿›è¡Œå®éªŒï¼Œæ ¸å¯†åº¦bootstrapæ–¹æ³•è¿‘ä¼¼ç»™å‡ºç”±$\hat p_h(x)$æ„é€ çš„ç½®ä¿¡æ°´å¹³ä¸º$95%$ç½®ä¿¡å¸¦çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1. ä»ç»éªŒåˆ†å¸ƒ$\hat F_n$ä¸­é‡æŠ½æ ·$X_1^*,X_2^*,...X_n^*$ï¼Œæ¯ä¸ªæ ·æœ¬ç‚¹çš„æ¦‚ç‡å‡ä¸º$\frac 1n$
2. åŸºäºBootstrapæ ·æœ¬$X_1^*,X_2^*,...X_n^*$ï¼ŒæŠ½æ ·è®¡ç®—$\hat p^*_h$
3. è®¡ç®—$R=sup_x\sqrt{nh}||\hat p_h-\hat p_h||_\inf$
4. é‡å¤æ­¥éª¤1ï½3$B$æ¬¡ï¼Œå¾—åˆ°$R_1,R_2,...,R_B$
5. ä»¤$z_\alpha$æ˜¯$\{R_j,j=1,...,B\}$çš„$\alpha$åˆ†ä½æ•°$$\frac 1B \sum_{j=1}^B I(R_j>z_\alpha)\approx \alpha$$
6. ä»¤$$l_n(x)=\hat p_h(x)-\frac{z_\alpha}{\sqrt{nh}},\quad u_n(x)=\hat p(x)+\frac{z_\alpha}{\sqrt{nh}}$$

```{r,warning=F,message=F}
#è®¾å®šè¿­ä»£æ¬¡æ•°
B=1000
n=length(galaxies)
set.seed(342423)

#å¯¹åŸæ ·æœ¬æ ¸å¯†åº¦ä¼°è®¡
h=bw.SJ(galaxies)
org=density(galaxies,kernel="gaussian",bw=h,from=min(galaxies),to=max(galaxies))

test=max(org$x)
  
#æ•°ç»„ä¿å­˜R
R<-rep(0,B)

#è¿›è¡ŒBæ¬¡è¿­ä»£
for(i in 1:B)
{
  #æœ‰è¿”å›é‡æŠ½æ ·
  sam<-sample(galaxies,n,replace = T)
  
  #åŸºäºBootstrapæ ·æœ¬è¿›è¡Œæ ¸å¯†åº¦ä¼°è®¡
  den=density(sam,kernel="gaussian",bw=h,from=min(galaxies),to=max(galaxies))
  
  #æ±‚R
  R[i]=sqrt(n*h)*max(abs(org$y-den$y))
}

#å¯»æ‰¾Rçš„alphaåˆ†ä½æ•°
z=quantile(R,0.05)

#æ±‚ç½®ä¿¡é™
l=org$y-z/sqrt(n*h)
u=org$y+z/sqrt(n*h)

l[l<0]=0
u[u>1]=1
plot(org$x,org$y,type="l",lty=1,col="red",xlab='',ylab="Density",ylim=c(0,0.00023))
lines(org$x,l,lty=2,col="red")
lines(org$x,u,lty=2,col="red")
```

#### å°è¯•é™ä½åå·®çš„ç‚¹ä¼°è®¡æ–¹æ³•ç»™å‡º$p(x)$çš„è¿‘ä¼¼ä¼°è®¡$\hat p(.)$ï¼Œå–$x$åœ¨æœ€å°å€¼å’Œæœ€å¤§å€¼å‡åŒ€å˜åŒ–ï¼Œæ¯”è¾ƒ$\hat p_h(x)$,$\hat p_{2h}(x)$å’Œ$\hat p(x)$ä¸‰ä¸ªç‚¹ä¼°è®¡çš„å·®å¼‚ã€‚

é¦–å…ˆåŸºäºé™ä½åå·®çš„ç‚¹ä¼°è®¡æ–¹æ³•ç»™å‡º$p(x)$çš„è¿‘ä¼¼ä¼°è®¡$\hat p(x)$ã€‚
$$\hat p(x)=\hat p_h(x)-\hat b(x)=\frac 43(\hat p_h(x)-\frac 14\hat p_{2h}(x))$$

ä¸‹é¢ç¼–å†™Rä»£ç è¿›è¡Œä¼°è®¡ï¼Œ$h$ä¸ä¸Šä¸€é¢˜ä½¿ç”¨ç›¸åŒçš„å–å€¼ï¼š
```{r,warning=F,message=F}
ph=density(galaxies,kernel="gaussian",bw=h,from=min(galaxies),to=max(galaxies))

p2h=density(galaxies,kernel="gaussian",bw=2*h,from=min(galaxies),to=max(galaxies))

#é™ä½åå·®çš„ç‚¹ä¼°è®¡
p_hat=4/3*(ph$y-p2h$y/4)

#ç»˜åˆ¶å›¾åƒ
par(family="PingFang SC")
plot(p2h$x,p_hat,col="red",xlab="",ylab="Density",type='l')
lines(ph$x,ph$y,col="blue")
lines(p2h$x,p2h$y,col="orange")
legend("topright",c("é™ä½åå·®çš„ç‚¹ä¼°è®¡","\\hat p_h(x)","\\hat p_{2h}(x)"),col=c("red","blue","orange"),lty=1)

```


çº¢çº¿ä¸ºé™ä½åå·®çš„ç‚¹ä¼°è®¡ç»“æœï¼Œä»å›¾åƒå¯ä»¥çœ‹å‡ºé™ä½åå·®çš„ç‚¹ä¼°è®¡æ›²çº¿æ•ˆæœæ›´å¥½ã€‚